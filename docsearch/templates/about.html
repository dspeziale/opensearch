{% extends "base.html" %}

{% block page_title %}Informazioni{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-info-circle"></i> DocSearch</h3>
            </div>
            <div class="card-body">
                <h4>Sistema di Documentazione Intelligente</h4>
                <p class="lead">
                    DocSearch è un sistema avanzato di gestione e ricerca documentale che utilizza OpenSearch e AI per fornire risposte intelligenti alle tue domande.
                </p>

                <hr>

                <h5><i class="fas fa-star text-warning"></i> Caratteristiche Principali</h5>
                <ul>
                    <li><strong>Ricerca Intelligente:</strong> Trova documenti usando linguaggio naturale</li>
                    <li><strong>RAG (Retrieval Augmented Generation):</strong> Risposte intelligenti con percorsi di approfondimento</li>
                    <li><strong>Multi-formato:</strong> Supporta PDF, Word, Excel, HTML, Markdown e più</li>
                    <li><strong>Indicizzazione Automatica:</strong> I documenti vengono elaborati e indicizzati automaticamente</li>
                    <li><strong>Estrazione Keywords:</strong> Keywords estratte automaticamente per ricerca avanzata</li>
                    <li><strong>Summary Automatico:</strong> Ogni documento viene riassunto per navigazione rapida</li>
                </ul>

                <hr>

                <h5><i class="fas fa-server text-success"></i> Server OpenSearch</h5>
                <div id="server-info-loading" class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Caricamento...</span>
                    </div>
                    <p class="text-muted mt-2">Caricamento informazioni server...</p>
                </div>
                <div id="server-info-content" style="display: none;">
                    <!-- Contenuto dinamico -->
                </div>
                <div id="server-info-error" class="alert alert-warning" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i> Impossibile caricare le informazioni del server
                </div>

                <hr>

                <h5><i class="fas fa-cogs text-info"></i> Tecnologie</h5>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><i class="fab fa-python text-primary"></i> <strong>Python 3.9+</strong></li>
                            <li><i class="fas fa-server text-success"></i> <strong>Flask</strong> - Web Framework</li>
                            <li><i class="fas fa-search text-warning"></i> <strong>OpenSearch</strong> - Search Engine</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><i class="fas fa-robot text-danger"></i> <strong>RAG Engine</strong> - AI Responses</li>
                            <li><i class="fas fa-palette text-info"></i> <strong>AdminLTE</strong> - UI Framework</li>
                            <li><i class="fas fa-file-pdf text-danger"></i> <strong>Multi-format Parsing</strong></li>
                        </ul>
                    </div>
                </div>

                <hr>

                <h5><i class="fas fa-question-circle text-danger"></i> Come Usare</h5>
                <div class="card">
                    <div class="card-body">
                        <ol>
                            <li><strong>Carica documenti</strong> dalla pagina Upload</li>
                            <li><strong>Attendi l'indicizzazione</strong> (automatica)</li>
                            <li><strong>Cerca</strong> usando domande o parole chiave</li>
                            <li><strong>Ottieni risposte intelligenti</strong> con percorsi di approfondimento</li>
                            <li><strong>Esplora i documenti</strong> suggeriti</li>
                        </ol>
                    </div>
                </div>

                <hr>

                <h5><i class="fas fa-lightbulb text-warning"></i> Tips & Tricks</h5>
                <div class="alert alert-info">
                    <ul class="mb-0">
                        <li>Usa <strong>domande complete</strong> per risultati migliori: "Come installare OpenSearch?" invece di "installare"</li>
                        <li>Il sistema è <strong>multilingua</strong> - funziona in italiano e inglese</li>
                        <li>Clicca sui <strong>suggerimenti</strong> per esplorare argomenti correlati</li>
                        <li>Segui il <strong>percorso di approfondimento</strong> per una comprensione completa</li>
                    </ul>
                </div>

                <hr>

                <div class="text-center">
                    <p class="text-muted">
                        <i class="fas fa-code"></i> Sviluppato con ❤️ usando Python & OpenSearch
                    </p>
                    <p>
                        <a href="/" class="btn btn-primary">
                            <i class="fas fa-home"></i> Torna alla Home
                        </a>
                        <a href="/upload" class="btn btn-success">
                            <i class="fas fa-upload"></i> Carica Documenti
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    loadServerInfo();
});

function loadServerInfo() {
    $.ajax({
        url: '/api/server-info',
        method: 'GET',
        success: function(response) {
            $('#server-info-loading').hide();

            if (response.success) {
                displayServerInfo(response);
            } else {
                $('#server-info-error').show();
            }
        },
        error: function(xhr, status, error) {
            $('#server-info-loading').hide();
            $('#server-info-error').show();
        }
    });
}

function displayServerInfo(info) {
    // Determina il colore dello stato del cluster
    let healthColor = 'success';
    let healthIcon = 'check-circle';
    if (info.cluster_health.status === 'yellow') {
        healthColor = 'warning';
        healthIcon = 'exclamation-triangle';
    } else if (info.cluster_health.status === 'red') {
        healthColor = 'danger';
        healthIcon = 'times-circle';
    }

    let indexStatsHtml = '';
    if (info.index_stats && Object.keys(info.index_stats).length > 0) {
        indexStatsHtml = `
            <div class="col-md-6 mb-2">
                <strong>Documenti indicizzati:</strong> ${info.index_stats.docs_count}
            </div>
            <div class="col-md-6 mb-2">
                <strong>Dimensione indice:</strong> ${info.index_stats.store_size_mb} MB
            </div>
        `;
    }

    const html = `
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <strong>Cluster:</strong> ${info.cluster_name}
                    </div>
                    <div class="col-md-6 mb-2">
                        <strong>Versione:</strong> ${info.version}
                    </div>
                    <div class="col-md-6 mb-2">
                        <strong>Host:</strong> ${info.host}:${info.port}
                    </div>
                    <div class="col-md-6 mb-2">
                        <strong>Indice:</strong> <code>${info.index_name}</code>
                    </div>
                    <div class="col-md-6 mb-2">
                        <strong>Stato Cluster:</strong>
                        <span class="badge badge-${healthColor}">
                            <i class="fas fa-${healthIcon}"></i> ${info.cluster_health.status.toUpperCase()}
                        </span>
                    </div>
                    <div class="col-md-6 mb-2">
                        <strong>Nodi:</strong> ${info.cluster_health.number_of_nodes}
                    </div>
                    ${indexStatsHtml}
                </div>

                <div class="mt-3">
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i>
                        <strong>Shards:</strong>
                        Active: ${info.cluster_health.active_shards} |
                        Relocating: ${info.cluster_health.relocating_shards} |
                        Initializing: ${info.cluster_health.initializing_shards} |
                        Unassigned: ${info.cluster_health.unassigned_shards}
                    </small>
                </div>
            </div>
        </div>
    `;

    $('#server-info-content').html(html).show();
}
</script>
{% endblock %}
